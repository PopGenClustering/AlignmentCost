# Alignment Cost

This folder contains all datasets used as examples and the code (in a Python package ```AlignmentCost```) to perform the empirical data analysis described in the article **"A Dirichlet model of alignment cost in mixed-membership unsupervised clustering"**. 

## Contents

The **data** folder contains four data files taken from the Supplementary materials of Fortier et al. 2020 that we used for the empirical anlaysis. We modified the ordering of the populations and the ordering of the clusters in the raw *CLUMPP* data files so that the membership barplot pattern of the first replicates of both datasets are consistent with that of the Fig. 2 in Fortier et al. 2020.  
 * *all_indfile.txt* and *codis_indfile.txt* are adapted from *CLUMPP/CLUMPP_input/all_indfile.txt* and *CLUMPP/CLUMPP_input/codis_indfile.txt* of Fortier et al. 2020 Supplementary. 
 * *all_clumpp_results.txt* and *codis_clumpp_results.txt* are takend from *CLUMPP/CLUMPP_output/all_ind_miscfile.txt* and *CLUMPP/CLUMPP_output/codis_ind_miscfile.txt* files.

The **AlignmentCost** folder contains the code files: *fund_utils.py* and *main.py*.
 * *fund_utils.py* contains several helper functions for data analysis and visualization, including 
   * ```repdist(a,b)``` which implements Eq. 10 in the article,
   * ```repdist0(a)``` which implements Eq. 11,
   * and ```alignment_cost(a,b)``` which implements Eq. 12.
 * *main.py* contains the major code we use to analyze the datasets and produce the plots in Fig. 5 and 6. It also serves as the main body of the Python package.

The **scripts** folder contains the parameter files used for the examples (more details in the next section), as well as a sample bash script with the command line argument.

The **output** folder will be automatically generated if run the provided examples. Figures will be output to this folder.

## Usage

### How to install

* Install [Python 3](https://www.python.org/downloads/).
* Open a terminal shell. E.g., [Git Bash](https://git-scm.com/downloads) shell on Windows, Bash Shell on Linux, or Mac Terminal on Mac.
* Install the package:

  * Download and install the package from GitHub:
 
    Download this repository to local (click on the green Code button on the top right corner, then download the repository as a ZIP file.)

    Navigate to the directory in the terminal (using command ```ls```). You should now be under the main ```AlignmentCost/``` directory which contains this [README.md](README.md) file.

    ```
    pip install -e .
    ```
    
  * Alternatively, you may install the package (without data and example scripts) directly from GitHub:

    ```
    pip install git+https://github.com/xr-cc/AlignmentCost
    ```

### How to run the examples
You may reproduce the analysis on the datasets described in the article.

  * For *STRUCTURE* replicates based on the full set of 791 loci (Fig. 5):
    ```
    python -m AlignmentCost.main --param_file scripts/all_param.txt
    ```
  
  * For *STRUCTURE* replicates based on 13 CODIS loci (Fig. 6):
    ```
    python -m AlignmentCost.main --param_file scripts/codis_param.txt  
    ```
  
  These will generate 5 output figures for each dataset, corresponding to the 5 panels in the manuscript figures:
  A. The stacked bar plots of all replicates (not aligned yet).
  B. A heatmap of pairwise theoretical cost between replicates.
  C. A heatmap of pairwise empirical cost between replicates.
  D. A heatmap of the relative different between the two costs.
  E. A cost vs. permutation plot showing all the possible permutations of clusters with respect to the first replicate and their theoretical alignment cost, together with bars showing the empirical costs from the rest of the replicates. The permutations (alignment) of the replicates w.r.t. the first one are generated by *CLUMPP*.

### How to run on your own data
  ```
  python -m AlignmentCost.main --param_file PATH_TO_YOUR_OWN_PARAMETER_FILE
  ```
  PATH_TO_YOUR_OWN_PARAMETER_FILE should contain information about your own data, where 
  1. ```input_file``` points to a **space-delimited** input file in the same format as the exemplary file  [```data/all_indfile.txt```](data/all_indfile.txt). It should contain 5+K columns, where K is the number of clusters in the replicates. The 2nd column contains the individual identifier number and the 4th column contains the population identifier number. It follows the *CLUMPP* individual input file format. The path must be wrapped by quotes, as in the examplary file.
  2. ```perm_file``` points to a **space-delimited** file containing the correct permutations (alignment) with respect to the first replicate. Each row corresponds to the permutation of one replicate, and each column corresponds to a cluster. The first row should always be ```1 2 ... K```. This can be extracted from the *CLUMPP*. The path must be wrapped by quotes, as in the examplary file. 
  3. ```output_path``` points to the directory where you want to save your output figures. The path must be wrapped by quotes, as in the examplary file.
  4. ```R``` is the number of replicates
  5. ```vmax``` the number to specify the upper limit of the colorbar when plotting the heatmap of costs (Panel B and C). You may leave it as the default value 1.0.
  6. ```cost_vs_perm_label_above_bar``` is either ```True``` or ```False```, depending on where you want the labels of the empirical costs to be in Panel E.
  * Note that the paths can either be relative or absolute.
  
## Citation:
>
